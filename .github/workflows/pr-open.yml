name: PR Open

on:
  pull_request:

permissions: {}

jobs:
  validate-content:
    name: Validate Content
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check instruction length
        run: |
          file=".github/copilot-instructions.md"
          chars=$(wc -m < "$file")
          limit=4000
          if [ "$chars" -gt "$limit" ]; then
            echo "❌ Instructions too long: $chars chars (limit: $limit)"
            echo "GitHub Custom Instructions has a 4000-character limit."
            exit 1
          fi
          echo "✅ Instructions length OK: $chars chars (limit: $limit)"

      - name: Check for broken internal links
        run: |
          for file in README.md .github/*.md; do
            [ -f "$file" ] || continue
            { grep -oE '\]\([^)]+\)' "$file" || true; } | \
              sed 's/^\]\(//;s/)$//' | \
              while read -r link; do
                [[ "$link" =~ ^# ]] && continue
                [[ "$link" =~ ^https?:// ]] && continue
                [[ "$link" =~ ^mailto: ]] && continue
                path="${link%%#*}"
                [ -z "$path" ] && continue
                if [ ! -e "$path" ]; then
                  echo "❌ Broken link in $file: $link"
                  echo "broken=1" >> /tmp/link_errors
                fi
              done
          done
          [ -f /tmp/link_errors ] && exit 1 || true
